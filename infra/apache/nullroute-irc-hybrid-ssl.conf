# NullRoute IRC - Apache SSL vhost template
# Replace DOMAIN_NAME and CERT_PATH with your values
# Cert paths: typically /etc/letsencrypt/live/YOUR_DOMAIN/

<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName irc.example.com
    ServerAlias chat.example.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/YOUR_DOMAIN/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/YOUR_DOMAIN/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    ProxyPreserveHost On
    ProxyRequests Off

    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:4000/$1" [P,L]

    ProxyPass /api/ http://localhost:4000/api/
    ProxyPassReverse /api/ http://localhost:4000/api/
    ProxyPass / http://localhost:4000/
    ProxyPassReverse / http://localhost:4000/

    ProxyTimeout 300

    ErrorLog ${APACHE_LOG_DIR}/nullroute-irc-ssl-error.log
    CustomLog ${APACHE_LOG_DIR}/nullroute-irc-ssl-access.log combined
</VirtualHost>
</IfModule>
